[[authentication-options]]
== Authentication Options

[[active-directory-authentication]]
=== Active Directory Authentication

You can use your existing Active Directory server for
authentication/authorization on Management Center. In the
"Configure Security" page, select **Active Directory** from
the "Security Provider" combo box, and the following form page appears:

image::ConfigureAD.png[Active Directory Configuration]

Provide the details in this form for your Active Directory server:

* **URL:** URL of your Active Directory server, including the
schema (`ldap://` or `ldaps://`) and port.
* **Domain:** Domain of your organization on Active Directory.
* **Admin Group(s):** Members of this group and its nested groups
have admin privileges on Management Center. To use more
than one group, separate them with a semicolon (;).
* **User Group(s):** Members of this group and its nested groups
have read and write privileges on Management Center. To
use more than one group, separate them with a semicolon (;).
* **Read-only User Group(s):** Members of this group and its nested
groups have only read privilege on Management Center. To
use more than one group, separate them with a semicolon (;).
* **Metrics-only Group(s):** Members of this group and its nested
groups have the privilege to see only the metrics on Management
Center. To use more than one group, separate them with a semicolon (;).
* **Test Username:** Username to test the Active Directory configuration
with. Note that this value will not be saved and only be used for testing
the Active Directory configuration.
* **Test Password:** Password to test the Active Directory configuration
with. Note that this value will not be saved and only be used for testing
the Active Directory configuration.

Before saving the configuration, you can test it by clicking the **Test**
button. Note that the user you test with needs to be a member of one of
the groups you have configured for Management Center.

Once configured, Active Directory settings are saved in a file named
`ldap.properties` under the `hazelcast-mc` directory mentioned in the
previous section. If you want to update your settings afterwards, you
need to update `ldap.properties` file and click **Reload Security Config**
button on the login page.

[[jaas-authentication]]
=== JAAS Authentication

You can use your own `javax.security.auth.spi.LoginModule` implementation
for authentication/authorization on Management Center. In the "Configure Security"
page, select **JAAS** from the "Security Provider" combo box, and the following
page appears:

image::ConfigureJAAS.png[JAAS Configuration]

Provide the details in this form for your JAAS `LoginModule` implementation:

* **Login Module Class**: Fully qualified class name of your
`javax.security.auth.spi.LoginModule` implementation.
* **Admin Group:** Members of this group have admin privileges
on Management Center.
* **User Group:** Members of this group have read and write privileges
on Management Center.
* **Read-only User Group:** Members of this group have only read privilege
on Management Center.
* **Metrics-only Group:** Members of this group have the privilege to see
only the metrics on Management Center.

The following is an example implementation. Note that we return two `java.security.Principal`
instances; one of them is the username and the other one is a group name, which
you will use when configuring JAAS security as described above.

[source,java]
----
import javax.security.auth.Subject;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.CallbackHandler;
import javax.security.auth.callback.NameCallback;
import javax.security.auth.callback.PasswordCallback;
import javax.security.auth.login.LoginException;
import javax.security.auth.spi.LoginModule;
import java.security.Principal;
import java.util.Map;

public class SampleLoginModule implements LoginModule {
    private Subject subject;
    private String password;
    private String username;

    @Override
    public void initialize(Subject subject, CallbackHandler callbackHandler, Map<String, ?> sharedState, Map<String, ?> options) {
        this.subject = subject;

        try {
            NameCallback nameCallback = new NameCallback("prompt");
            PasswordCallback passwordCallback = new PasswordCallback("prompt", false);

            callbackHandler.handle(new Callback[] {nameCallback, passwordCallback });

            password = new String(passwordCallback.getPassword());
            username = nameCallback.getName();
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    @Override
    public boolean login() throws LoginException {
        if (!username.equals("emre")) {
            throw new LoginException("Bad User");
        }

        if (!password.equals("pass1234")) {
            throw new LoginException("Bad Password");
        }

        subject.getPrincipals().add(new Principal() {
            public String getName() {
                return "emre";
            }
        });

        subject.getPrincipals().add(new Principal() {
            public String getName() {
                return "MancenterAdmin";
            }
        });

        return true;
    }

    @Override
    public boolean commit() throws LoginException {
        return true;
    }

    @Override
    public boolean abort() throws LoginException {
        return true;
    }

    @Override
    public boolean logout() throws LoginException {
        return true;
    }
}
----

[[ldap-authentication]]
=== LDAP Authentication

You can use your existing LDAP server for authentication/authorization on
Management Center. In the "Configure Security" page, select **LDAP** from
the "Security Provider" combo box, and the following form page appears:

image::ConfigureLDAP.png[LDAP Configuration]

Provide the details in this form for your LDAP server:

* **URL:** URL of your LDAP server, including schema
(`ldap://` or `ldaps://`) and port.
* **Distinguished name (DN) of user:** DN of a user that has admin
privileges on the LDAP server. It is used to connect to the server
when authenticating users.
* **Search base DN:** Base DN to be used for searching users/groups.
* **Additional user DN:** Appended to "Search base DN" and used for finding users.
* **Additional group DN:** Appended to "Search base DN" and used for finding groups.
* **Admin Group(s):** Members of this group and its nested groups
have admin privileges on Management Center. To use more than one group,
separate them with a semicolon (;).
* **User Group(s):** Members of this group and its nested groups have
read and write privileges on Management Center. To use more than one
group, separate them with a semicolon (;).
* **Read-only User Group(s):** Members of this group and its nested groups
have only read privilege on Management Center. To use more than
one group, separate them with a semicolon (;).
* **Metrics-only Group(s):** Members of this group and its nested groups
have the privilege to see only the metrics on Management Center.
To use more than one group, separate them with a semicolon (;).
* **Start TLS:** Enable if your LDAP server uses **Start TLS** operation.
* **User Search Filter:** LDAP search filter expression to search for
the users. For example, `uid={0}` searches for a username that matches with
the `uid` attribute.
* **Group Search Filter:** LDAP search filter expression to search for
the groups. For example, `uniquemember={0}` searches for a group that
matches with the `uniquemember` attribute.

NOTE: Values for **Admin**, **User**, **Read-only** and **Metrics-Only** group names must
be given as plain names. They should not contain any LDAP attributes such
as `CN`, `OU` and `DC`.

Once configured, LDAP settings are saved in a file named `ldap.properties`
under the `hazelcast-mc` directory mentioned in the previous section. If you
want to update your settings afterwards, you need to update the `ldap.properties`
file and click on the **Reload Security Config** button on the login page.

[[ldap-ssl]]
==== Enabling TLS/SSL for LDAP

If your LDAP server is using `ldaps` (LDAP over SSL) protocol or the **Start
TLS** operation, use the following command line
parameters for your Management Center deployment:

* `-Dhazelcast.mc.ldap.ssl.trustStore`: Path to the truststore. This
truststore needs to contain the public key of your LDAP server.
* `-Dhazelcast.mc.ldap.ssl.trustStorePassword`: Password of the truststore.
* `-Dhazelcast.mc.ldap.ssl.trustStoreType`: Type of the truststore. Its default value is JKS.
* `-Dhazelcast.mc.ldap.ssl.trustManagerAlgorithm`: Name of the algorithm
based on which the authentication keys are provided. System default is used
if none is provided. You can find out the default by calling the
`javax.net.ssl.TrustManagerFactory#getDefaultAlgorithm` method.

[[password-encryption]]
==== Password Encryption

By default, the password that you use in the LDAP configuration is saved on the
`ldap.properties` file in clear text. This might pose a security risk. To
store the LDAP password in an encrypted form, we offer the following options:

* **Provide a keystore password:** This will create and manage a Java
keystore under the Management Center home directory. The LDAP password
will be stored in this keystore in encrypted form.
* **Configure an external Java keystore:** This will use an existing Java
keystore. This option might also be used to store the password in an HSM
that provides a Java keystore API.

When you do either, the LDAP password you enter on the initial configuration
UI dialog will be stored in encrypted form in a Java keystore instead of the
`ldap.properties` file.

NOTE: You can also encrypt the password before saving it on `ldap.properties`.
See <<variable-replacers, Variable Replacers>> for more information.

[[providing-a-master-key-for-encryption]]
===== Providing a Master Key for Encryption

There are two ways to provide a master key for encryption:

* If you deploy Management Center on an application server, you need to
set `MC_KEYSTORE_PASS` environment variable before starting Management
Center. This option is less secure. You should clear the environment
variable once you make sure you can log in with your LDAP credentials
to minimize the security risk.
* If you're starting Management Center from the command line, you can
start it with `-Dhazelcast.mc.askKeyStorePassword`. Management Center
will ask for the keystore password upon start and use it as a password
for the keystore it creates. This option is more secure as it only stores
the keystore password in the memory.

By default, Management Center will create a Java keystore file under the
Management Center home directory with the name `mancenter.jceks`. You can
change the location of this file by using the
`-Dhazelcast.mc.keyStore.path=/path/to/keyStore.jceks` JVM argument.

[[configuring-an-external-java-keystore]]
===== Configuring an External Java KeyStore

If you don't want Management Center to create a keystore for you and
use an existing one that you've created before (or an HSM), set the
following JVM arguments when starting Management Center:

* `-Dhazelcast.mc.useExistingKeyStore=true`: Enables use of an existing keystore.
* `-Dhazelcast.mc.existingKeyStore.path=/path/to/existing/keyStore.jceks`: Path
to the keystore. You do not have to set it if you use an HSM.
* `-Dhazelcast.mc.existingKeyStore.pass=somepass`: Password for the keystore.
You do not have to set it if HSM provides another means to unlock HSM.
* `-Dhazelcast.mc.existingKeyStore.type=JCEKS`: Type of the keystore.
* `-Dhazelcast.mc.existingKeyStore.provider=com.yourprovider.MyProvider`: Provider
of the keystore. Leave empty to use the system provider. Specify the class name
of your HSM's `java.security.Provider` implementation if you use an HSM.

NOTE: Make sure your keystore supports storing `SecretKey`s.

[[updating-encrypted-passwords]]
==== Updating Encrypted Passwords

You can use the `update-ldap-password` command in the MC Conf tool to update
the encrypted LDAP password stored in the keystore. Please see this command's
<<update-ldap-password, description>> for details.